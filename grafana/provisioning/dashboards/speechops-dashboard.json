{
  "id": null,
  "uid": "speechops-api-monitoring",
  "title": "SpeechOps - API Monitoring",
  "tags": [
    "api",
    "speechops",
    "monitoring"
  ],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 0,
  "refresh": "30s",
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "title": "API Health Status",
      "type": "stat",
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "targets": [
        {
          "expr": "speechops_api_health",
          "refId": "A",
          "legendFormat": "Health"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "type": "value",
              "options": {
                "1": {
                  "text": "HEALTHY",
                  "color": "green"
                },
                "0": {
                  "text": "UNHEALTHY",
                  "color": "red"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              }
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "title": "Model Status",
      "type": "stat",
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "targets": [
        {
          "expr": "speechops_model_loaded",
          "refId": "A",
          "legendFormat": "Model"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "type": "value",
              "options": {
                "1": {
                  "text": "LOADED",
                  "color": "green"
                },
                "0": {
                  "text": "NOT LOADED",
                  "color": "red"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              }
            ]
          }
        }
      }
    },
    {
      "id": 3,
      "title": "Processing Success Rate",
      "type": "gauge",
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "targets": [
        {
          "expr": "speechops_processing_success_rate",
          "refId": "A",
          "legendFormat": "Success Rate"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "min": 0,
          "max": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 0.5
              },
              {
                "color": "green",
                "value": 0.95
              }
            ]
          }
        }
      }
    },
    {
      "id": 4,
      "title": "Total API Requests (5m)",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "targets": [
        {
          "expr": "rate(speechops_requests_total[5m])",
          "refId": "A",
          "legendFormat": "{{method}} {{endpoint}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 5,
      "title": "Average Request Duration (ms)",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "targets": [
        {
          "expr": "(rate(speechops_request_duration_seconds_sum[5m]) / rate(speechops_request_duration_seconds_count[5m])) * 1000",
          "refId": "A",
          "legendFormat": "{{method}} {{endpoint}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 6,
      "title": "Model Prediction Duration",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "targets": [
        {
          "expr": "rate(speechops_prediction_duration_seconds_sum[5m]) / rate(speechops_prediction_duration_seconds_count[5m])",
          "refId": "A",
          "legendFormat": "Prediction Duration (s)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 7,
      "title": "Successful/Failed Predictions",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "targets": [
        {
          "expr": "rate(speechops_predictions_total[5m])",
          "refId": "A",
          "legendFormat": "{{status}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 8,
      "title": "Audio File Sizes (MB)",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 24
      },
      "targets": [
        {
          "expr": "increase(speechops_audio_size_bytes_sum[5m]) / 1000000",
          "refId": "A",
          "legendFormat": "Size (MB/s)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 9,
      "title": "System CPU Usage",
      "type": "gauge",
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 32
      },
      "targets": [
        {
          "expr": "rate(process_cpu_seconds_total{job=\"speechops-api\"}[1m]) * 100",
          "refId": "A",
          "legendFormat": "CPU %"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 100,
          "unit": "percent",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 50
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        }
      }
    },
    {
      "id": 10,
      "title": "System Memory Usage",
      "type": "gauge",
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 32
      },
      "targets": [
        {
          "expr": "process_resident_memory_bytes{job=\"speechops-api\"}",
          "refId": "A",
          "legendFormat": "RAM"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 500000000
              },
              {
                "color": "red",
                "value": 1000000000
              }
            ]
          }
        }
      }
    },
    {
      "id": 11,
      "title": "Processing Efficiency (RTF)",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 24
      },
      "targets": [
        {
          "expr": "rate(speechops_processing_rtf_sum[5m]) / rate(speechops_processing_rtf_count[5m])",
          "refId": "A",
          "legendFormat": "Avg RTF"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "RTF (Lower is better)"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1.0
              }
            ]
          }
        }
      }
    }
  ]
}